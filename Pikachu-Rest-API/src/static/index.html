<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Astronômico - NASA, Pokémon e Astrologia</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s ease-in-out infinite',
                        'bounce-slow': 'bounce 2s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-20px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Componente de Loading
        const LoadingSpinner = () => (
            <div className="flex items-center justify-center p-4">
                <div className="loading-spinner"></div>
                <span className="ml-3 text-yellow-300 animate-pulse">Carregando...</span>
            </div>
        );

        // Componente de Card
        const Card = ({ children, className = "" }) => (
            <div className={`bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20 card-hover ${className}`}>
                {children}
            </div>
        );

        // Componente de Botão
        const Button = ({ children, onClick, className = "", disabled = false }) => (
            <button
                onClick={onClick}
                disabled={disabled}
                className={`bg-gradient-to-r from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 
                           text-white font-semibold py-3 px-6 rounded-full transition-all duration-300 
                           transform hover:scale-105 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed ${className}`}
            >
                {children}
            </button>
        );

        // Componente NASA
        const NasaSection = () => {
            const [nasaData, setNasaData] = useState(null);
            const [loading, setLoading] = useState(false);

            const fetchNasaData = async () => {
                setLoading(true);
                try {
                    const response = await fetch('/api/nasa/apod');
                    const data = await response.json();
                    setNasaData(data);
                } catch (error) {
                    console.error('Erro ao buscar dados da NASA:', error);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <Card className="lg:col-span-2">
                    <div className="flex items-center mb-4">
                        <span className="text-3xl mr-3 animate-bounce-slow">🚀</span>
                        <h2 className="text-2xl font-bold text-yellow-300">NASA - Foto do Dia</h2>
                    </div>
                    
                    <Button onClick={fetchNasaData} disabled={loading} className="mb-4">
                        {loading ? 'Carregando...' : 'Obter Foto Astronômica do Dia'}
                    </Button>

                    <div className="bg-black/20 rounded-xl p-4 min-h-[200px]">
                        {loading ? (
                            <LoadingSpinner />
                        ) : nasaData ? (
                            <div className="text-white">
                                <h3 className="text-xl font-semibold mb-2 text-yellow-200">{nasaData.title}</h3>
                                <p className="text-sm mb-2"><strong>Data:</strong> {nasaData.date}</p>
                                <p className="text-sm mb-4 leading-relaxed">{nasaData.explanation}</p>
                                {nasaData.media_type === 'image' ? (
                                    <img 
                                        src={nasaData.url} 
                                        alt={nasaData.title} 
                                        className="w-full max-w-md rounded-lg shadow-lg mx-auto hover:scale-105 transition-transform duration-300"
                                    />
                                ) : (
                                    <a href={nasaData.url} target="_blank" rel="noopener noreferrer" 
                                       className="text-blue-300 hover:text-blue-200 underline">
                                        Ver vídeo
                                    </a>
                                )}
                                {nasaData.copyright && (
                                    <p className="text-xs mt-2 text-gray-300">© {nasaData.copyright}</p>
                                )}
                            </div>
                        ) : (
                            <div className="text-center text-gray-300 py-8">
                                Clique no botão para ver a foto astronômica do dia
                            </div>
                        )}
                    </div>
                </Card>
            );
        };

        // Componente Pokémon
        const PokemonSection = () => {
            const [pokemonData, setPokemonData] = useState(null);
            const [pokemonName, setPokemonName] = useState('');
            const [loading, setLoading] = useState(false);

            const fetchPokemon = async (name = '') => {
                setLoading(true);
                try {
                    const url = name ? `/api/pokemon/${name}` : '/api/pokemon/random';
                    const response = await fetch(url);
                    const data = await response.json();
                    setPokemonData(data);
                } catch (error) {
                    console.error('Erro ao buscar Pokémon:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handleSearch = () => {
                if (pokemonName.trim()) {
                    fetchPokemon(pokemonName.trim().toLowerCase());
                }
            };

            return (
                <Card>
                    <div className="flex items-center mb-4">
                        <span className="text-3xl mr-3 animate-float">🎮</span>
                        <h2 className="text-2xl font-bold text-yellow-300">Pokémon</h2>
                    </div>
                    
                    <div className="space-y-3 mb-4">
                        <input
                            type="text"
                            value={pokemonName}
                            onChange={(e) => setPokemonName(e.target.value)}
                            placeholder="Nome do Pokémon"
                            className="w-full px-4 py-2 rounded-full bg-white/90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                            onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                        />
                        <div className="flex gap-2">
                            <Button onClick={handleSearch} disabled={loading || !pokemonName.trim()} className="flex-1 text-sm">
                                Buscar
                            </Button>
                            <Button onClick={() => fetchPokemon()} disabled={loading} className="flex-1 text-sm">
                                Aleatório
                            </Button>
                        </div>
                    </div>

                    <div className="bg-black/20 rounded-xl p-4 min-h-[300px]">
                        {loading ? (
                            <LoadingSpinner />
                        ) : pokemonData ? (
                            <div className="text-white text-center">
                                <h3 className="text-xl font-semibold mb-2 text-yellow-200 capitalize">
                                    {pokemonData.name} (#{pokemonData.id})
                                </h3>
                                <img 
                                    src={pokemonData.sprite} 
                                    alt={pokemonData.name} 
                                    className="w-32 h-32 mx-auto mb-4 bg-white/10 rounded-full p-2 hover:scale-110 transition-transform duration-300"
                                />
                                <div className="text-sm space-y-1">
                                    <p><strong>Altura:</strong> {pokemonData.height / 10} m</p>
                                    <p><strong>Peso:</strong> {pokemonData.weight / 10} kg</p>
                                    <p><strong>Tipos:</strong> {pokemonData.types.join(', ')}</p>
                                    <p><strong>Habilidades:</strong> {pokemonData.abilities.join(', ')}</p>
                                </div>
                            </div>
                        ) : (
                            <div className="text-center text-gray-300 py-8">
                                Digite um nome ou clique em "Aleatório"
                            </div>
                        )}
                    </div>
                </Card>
            );
        };

        // Componente Horóscopo
        const HoroscopeSection = () => {
            const [horoscopeData, setHoroscopeData] = useState(null);
            const [selectedSign, setSelectedSign] = useState('aries');
            const [loading, setLoading] = useState(false);

            const signs = [
                'aries', 'taurus', 'gemini', 'cancer', 'leo', 'virgo',
                'libra', 'scorpio', 'sagittarius', 'capricorn', 'aquarius', 'pisces'
            ];

            const signNames = {
                aries: 'Áries', taurus: 'Touro', gemini: 'Gêmeos', cancer: 'Câncer',
                leo: 'Leão', virgo: 'Virgem', libra: 'Libra', scorpio: 'Escorpião',
                sagittarius: 'Sagitário', capricorn: 'Capricórnio', aquarius: 'Aquário', pisces: 'Peixes'
            };

            const fetchHoroscope = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`/api/horoscope/${selectedSign}`);
                    const data = await response.json();
                    setHoroscopeData(data);
                } catch (error) {
                    console.error('Erro ao buscar horóscopo:', error);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <Card>
                    <div className="flex items-center mb-4">
                        <span className="text-3xl mr-3 animate-pulse-slow">🔮</span>
                        <h2 className="text-2xl font-bold text-yellow-300">Horóscopo</h2>
                    </div>
                    
                    <div className="space-y-3 mb-4">
                        <select
                            value={selectedSign}
                            onChange={(e) => setSelectedSign(e.target.value)}
                            className="w-full px-4 py-2 rounded-full bg-white/90 text-gray-800 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                        >
                            {signs.map(sign => (
                                <option key={sign} value={sign}>{signNames[sign]}</option>
                            ))}
                        </select>
                        <Button onClick={fetchHoroscope} disabled={loading} className="w-full">
                            Ver Horóscopo
                        </Button>
                    </div>

                    <div className="bg-black/20 rounded-xl p-4 min-h-[200px]">
                        {loading ? (
                            <LoadingSpinner />
                        ) : horoscopeData ? (
                            <div className="text-white">
                                <h3 className="text-xl font-semibold mb-2 text-yellow-200">
                                    Horóscopo para {signNames[selectedSign]}
                                </h3>
                                <p className="text-sm mb-2"><strong>Data:</strong> {horoscopeData.data.date}</p>
                                <p className="text-sm leading-relaxed">{horoscopeData.data.horoscope_data}</p>
                            </div>
                        ) : (
                            <div className="text-center text-gray-300 py-8">
                                Selecione um signo e clique em "Ver Horóscopo"
                            </div>
                        )}
                    </div>
                </Card>
            );
        };

        // Componente Astronomia
        const AstronomySection = () => {
            const [astronomyData, setAstronomyData] = useState(null);
            const [loading, setLoading] = useState(false);
            const [activeEndpoint, setActiveEndpoint] = useState('');

            const fetchAstronomyData = async (endpoint) => {
                setLoading(true);
                setActiveEndpoint(endpoint);
                try {
                    const response = await fetch(`/api/astronomy/${endpoint}`);
                    const data = await response.json();
                    setAstronomyData(data);
                } catch (error) {
                    console.error('Erro ao buscar dados astronômicos:', error);
                } finally {
                    setLoading(false);
                }
            };

            const renderAstronomyData = () => {
                if (!astronomyData) return null;

                switch (activeEndpoint) {
                    case 'moon-phase':
                        return (
                            <div className="text-white">
                                <h3 className="text-xl font-semibold mb-2 text-yellow-200">🌙 Fase da Lua</h3>
                                <p className="text-sm mb-2"><strong>Local:</strong> {astronomyData.location || 'Rio de Janeiro'}</p>
                                <p className="text-sm mb-2"><strong>Data:</strong> {astronomyData.date}</p>
                                {astronomyData.imageUrl ? (
                                    <img 
                                        src={astronomyData.imageUrl} 
                                        alt="Fase da Lua" 
                                        className="w-full max-w-xs mx-auto rounded-lg shadow-lg hover:scale-105 transition-transform duration-300"
                                    />
                                ) : (
                                    <>
                                        <p className="text-sm mb-2"><strong>Fase:</strong> {astronomyData.phase}</p>
                                        <p className="text-sm"><strong>Horário:</strong> {astronomyData.time}</p>
                                    </>
                                )}
                            </div>
                        );
                    case 'iss-location':
                        return (
                            <div className="text-white">
                                <h3 className="text-xl font-semibold mb-2 text-yellow-200">🛰️ Localização da ISS</h3>
                                <p className="text-sm mb-2"><strong>Latitude:</strong> {astronomyData.iss_position.latitude}°</p>
                                <p className="text-sm mb-2"><strong>Longitude:</strong> {astronomyData.iss_position.longitude}°</p>
                                <p className="text-sm"><strong>Timestamp:</strong> {new Date(astronomyData.timestamp * 1000).toLocaleString('pt-BR')}</p>
                            </div>
                        );
                    case 'people-in-space':
                        return (
                            <div className="text-white">
                                <h3 className="text-xl font-semibold mb-2 text-yellow-200">👨‍🚀 Pessoas no Espaço</h3>
                                <p className="text-sm mb-3"><strong>Total:</strong> {astronomyData.number} pessoas</p>
                                <ul className="text-sm space-y-1">
                                    {astronomyData.people.map((person, index) => (
                                        <li key={index} className="flex justify-between">
                                            <span className="font-semibold">{person.name}</span>
                                            <span className="text-gray-300">{person.craft}</span>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        );
                    default:
                        return null;
                }
            };

            return (
                <Card className="lg:col-span-2">
                    <div className="flex items-center mb-4">
                        <span className="text-3xl mr-3 animate-float">🌙</span>
                        <h2 className="text-2xl font-bold text-yellow-300">Astronomia</h2>
                    </div>
                    
                    <div className="flex flex-wrap gap-2 mb-4">
                        <Button 
                            onClick={() => fetchAstronomyData('moon-phase')} 
                            disabled={loading}
                            className="text-sm"
                        >
                            Fase da Lua
                        </Button>
                        <Button 
                            onClick={() => fetchAstronomyData('iss-location')} 
                            disabled={loading}
                            className="text-sm"
                        >
                            Localização da ISS
                        </Button>
                        <Button 
                            onClick={() => fetchAstronomyData('people-in-space')} 
                            disabled={loading}
                            className="text-sm"
                        >
                            Pessoas no Espaço
                        </Button>
                    </div>

                    <div className="bg-black/20 rounded-xl p-4 min-h-[200px]">
                        {loading ? (
                            <LoadingSpinner />
                        ) : astronomyData ? (
                            renderAstronomyData()
                        ) : (
                            <div className="text-center text-gray-300 py-8">
                                Clique em um dos botões para ver informações astronômicas
                            </div>
                        )}
                    </div>
                </Card>
            );
        };

        // Componente Principal
        const App = () => {
            return (
                <div className="min-h-screen p-4 lg:p-8">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="text-center mb-8">
                            <h1 className="text-4xl lg:text-6xl font-bold text-white mb-4 animate-pulse-slow">
                                🌟 Sistema Astronômico 🌟
                            </h1>
                            <p className="text-lg text-white/80">
                                Explore o universo com NASA, Pokémon e Astrologia
                            </p>
                        </div>

                        {/* Grid de Cards */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <NasaSection />
                            <PokemonSection />
                            <HoroscopeSection />
                            <AstronomySection />
                        </div>

                        {/* Footer */}
                        <div className="text-center mt-8 text-white/60">
                            <p>Desenvolvido com ❤️ usando Flask, React e Tailwind CSS</p>
                        </div>
                    </div>
                </div>
            );
        };

        // Renderizar a aplicação
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>



        // Componente de Apresentações
        const PresentationSection = () => {
            const [markdown, setMarkdown] = useState("");
            const [title, setTitle] = useState("");
            const [loading, setLoading] = useState(false);
            const [pdfUrl, setPdfUrl] = useState(null);

            const generatePdf = async () => {
                setLoading(true);
                setPdfUrl(null);
                try {
                    const response = await fetch("/api/presentations/convert", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ markdown, title }),
                    });
                    const data = await response.json();
                    if (data.success) {
                        const byteCharacters = atob(data.pdf_base64);
                        const byteNumbers = new Array(byteCharacters.length);
                        for (let i = 0; i < byteCharacters.length; i++) {
                            byteNumbers[i] = byteCharacters.charCodeAt(i);
                        }
                        const byteArray = new Uint8Array(byteNumbers);
                        const blob = new Blob([byteArray], { type: "application/pdf" });
                        const url = URL.createObjectURL(blob);
                        setPdfUrl(url);
                    } else {
                        console.error("Erro ao gerar PDF:", data.error);
                    }
                } catch (error) {
                    console.error("Erro ao gerar PDF:", error);
                } finally {
                    setLoading(false);
                }
            };

            const loadExample = async () => {
                try {
                    const response = await fetch("/api/presentations/example");
                    const data = await response.json();
                    setMarkdown(data.example);
                    setTitle(data.title);
                } catch (error) {
                    console.error("Erro ao carregar exemplo:", error);
                }
            };

            return (
                <Card className="lg:col-span-3">
                    <div className="flex items-center mb-4">
                        <span className="text-3xl mr-3">📄</span>
                        <h2 className="text-2xl font-bold text-yellow-300">Gerador de Apresentações</h2>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <input
                                type="text"
                                value={title}
                                onChange={(e) => setTitle(e.target.value)}
                                placeholder="Título da Apresentação"
                                className="w-full px-4 py-2 rounded-full bg-white/90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-yellow-400 mb-4"
                            />
                            <textarea
                                value={markdown}
                                onChange={(e) => setMarkdown(e.target.value)}
                                placeholder="Digite seu Markdown aqui..."
                                className="w-full h-64 p-4 rounded-lg bg-white/90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                            ></textarea>
                            <div className="flex gap-2 mt-4">
                                <Button onClick={generatePdf} disabled={loading || !markdown.trim()}>
                                    {loading ? "Gerando PDF..." : "Gerar PDF"}
                                </Button>
                                <Button onClick={loadExample} disabled={loading} className="bg-gray-500 hover:bg-gray-600">
                                    Carregar Exemplo
                                </Button>
                            </div>
                        </div>
                        <div className="bg-black/20 rounded-xl p-4 min-h-[300px]">
                            {loading ? (
                                <LoadingSpinner />
                            ) : pdfUrl ? (
                                <iframe src={pdfUrl} className="w-full h-full rounded-lg"></iframe>
                            ) : (
                                <div className="text-center text-gray-300 py-8">
                                    O PDF gerado aparecerá aqui.
                                </div>
                            )}
                        </div>
                    </div>
                </Card>
            );
        };

        // Componente Principal
        const App = () => {
            return (
                <div className="min-h-screen p-4 lg:p-8">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="text-center mb-8">
                            <h1 className="text-4xl lg:text-6xl font-bold text-white mb-4 animate-pulse-slow">
                                🌟 Sistema Multifuncional 🌟
                            </h1>
                            <p className="text-lg text-white/80">
                                Explore o universo, crie apresentações e muito mais!
                            </p>
                        </div>

                        {/* Grid de Cards */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <PresentationSection />
                            <NasaSection />
                            <PokemonSection />
                            <HoroscopeSection />
                            <AstronomySection />
                        </div>

                        {/* Footer */}
                        <div className="text-center mt-8 text-white/60">
                            <p>Desenvolvido com ❤️ usando Flask, React e Tailwind CSS</p>
                        </div>
                    </div>
                </div>
            );
        };

        // Renderizar a aplicação
        ReactDOM.render(<App />, document.getElementById("root"));
    </script>
</body>
</html>

